# setup_devenv
文責：池田明浩（福本松島研究室）
## はじめに
このドキュメントは、九州工業大学工学部電気電子工学科GEコースのテーマの1つであるロボレーサのソフトウェア開発環境構築手順をまとめたものです。
車体の構築などについては、キットの販売ページをご確認ください。
[販売ページ](https://modeco-ad.jp/jpn/modecar/modecar-tt02-building-set/)

## 必要なもの
### Raspberry Pi 4B
車体への取り付け方は自由ですが、開発時にケーブル類が接続しやすいようにすることをお勧めします。
### microSDカード (16GB以上推奨)
OSやソフトウェアが格納されます。microSD-SD変換アダプタがあると、他のPCでOSイメージを書き込む際に便利です。
### USBキーボード・マウス
Raspberry Piに接続して操作するために必要です。無線接続キーボードがあると、キーボードで自由に車体を操作できるようになります。
### HDMIディスプレイ・ケーブル
最終的にはディスプレイをつなげずに走行しますが、Raspberrypi単体で開発する際に必要です。
※リモート接続で開発する方法もあります。
### ネットワーク接続環境
Raspberry Piをインターネットに接続するために必要です。無線LAN環境にも対応しています。

## 初期設定
### 1. OSのインストール
Raspbian OS (Raspberry Pi OS)をmicroSDカードにインストールします。詳しい手順は公式サイトや他の解説サイトを参照してください。
著者が使用しているバージョンは「」になります。

### 2.ロボカー向けリポジトリのクローン
国内大会MAGP公式のロボカー向けリポジトリをクローンします。ターミナルを開き、以下のコマンドを実行してください
```bash
git clone https://github.com/Hiroyuki-Okuda/OpenMiniCarWorks.git
```
なお、gitがインストールされていない場合は、以下のコマンドでインストールしてください。
```bash
sudo apt-get update
sudo apt-get install git
```
### 3. 必要なライブラリ・ツールのインストール
クローンしたリポジトリにあるサンプルスクリプトは既存Pythonライブラリを用いています。Raspbianをインストールしたのならすでにインストールされていますが、必要に応じてpipでインストールしてください。
例えば、LIDAR（周囲測距デバイス）の結果を極座標グラフに表示するにはmatplotlibが必要です。もし持っていなければ、以下のコマンドでインストールしてください。
```bash
pip install matplotlib
```
現在インストールされているライブラリは以下のコマンドで確かめることができます
```bash
pip list
```

### 4. 公式ドキュメントに記載の動作確認
ここからは、公式が配布している、各センサデバイスの動作確認ドキュメントに従って進めていただきます。p.7から進めてください。いくつか異なる点・注意すべき点がありますので、記しておきます。
[動作確認ドキュメント](https://modeco-ad.jp/jpn/wp-content/uploads/2025/01/ADRCCar%E3%83%9E%E3%83%8B%E3%83%A5%E3%82%A2%E3%83%AB_v1.04.pdf)

***執筆中です。各自の環境特有の誤動作・アクシデントがあると思いますが、ぜひご連絡いただけると嬉しいです。***


#### 6.3 カメラのテスト
`libcamera-hello`でカメラの動作確認ができると書いてありますが、これは起動時にOSが正しくカメラを認識できていない場合動かないことがあります。
様々なエラー（カメラケーブルが正しく接続されていない、カメラの破損、等々）が考えられますが、まずはOSの`config.txt`を確認してください。
```bash
cd /boot
cat config.txt
```
おそらく、このテキストファイルの最後の記述がカメラなどのものになっているはずです。
```
[all]
camera_auto_detect=1
dtoverlay=imx219

gpu_mem=128
enable_uart=1
```
2行目でカメラの指定をしています。これはV2カメラの識別子になりますが、キットに付属しているのはV3カメラになります。この行を`#`でコメントアウトして、次の行に`dtoverlay=imx708`を追加してください。

管理者（root）でないと編集できないファイルになっていますので、`sudo`を先頭につけてテキストエディタを起動します。（デフォルトで入っているテキストエディタで著者がおすすめするのはnanoというものです）
```bash
sudo nano config.txt
```

これができたら再起動して、再度カメラのテストを確かめてください。

#### テンプレ
「#」4個と半角スペースをつけて題目を書いてください。その後、改行して詳細なトラブルの内容と解決法を書いてください。

## 開発の進め方
基本的なリファレンス集が存在しないので、リポジトリで使用されている関数やクラス（基本的には一般的なものがおおい）を参考に、各デバイスの使用法を調べてください。今後、別ドキュメントやスクリプトでまとめていければと思います。



